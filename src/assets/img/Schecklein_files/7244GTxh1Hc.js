if (self.CavalryLogger) { CavalryLogger.start_js(["EO\/Fh"]); }

__d("CometUFICommentListState",["ErrorNormalizeUtils","FBLogger","UFI2CommentsConfig","UFI2ViewOption","gkx","recoverableViolation","unrecoverableViolation"],(function(a,b,c,d,e,f){"use strict";function g(a){var b=a.count,c=a.direction,d=a.error,e=a.hasMore,f=a.isLoading,g=a.pageSize;a=a.totalCount;if(a!=null&&a===0)return null;if(b===0)return null;return!e?null:{__type:"PAGER",count:Math.min(b,g),direction:c,status:{error:d,pending:f}}}function h(a){var b=a.count,c=a.expanded;a=a.minCountToShowCollapser;if(!c)return null;if(a==null)return null;return b<=a?null:{__type:"REPLIES_COLLAPSER",count:b}}function i(a){var b=a.error,c=a.expanded,d=a.isLoading;a=a.totalCount;return c||a===0?null:{__type:"REPLIES_EXPANDER",count:a,status:{error:b,pending:d}}}function j(a){var b=a.direction;a=a.page;if(b==="forward"){b=Math.max(0,a.afterCount-1);return babelHelpers["extends"]({},a,{afterCount:b,hasNext:b>0})}b=Math.max(0,a.beforeCount-1);return babelHelpers["extends"]({},a,{beforeCount:b,hasPrevious:b>0})}function k(a,c){var d=l(a,c);if(a.__type!=="INITIAL_STATE"&&c==null)throw b("unrecoverableViolation")("Expected state not to be null","ufi2");return d}function l(a,c){if(a.__type==="INITIAL_STATE"){var d,e=a.args,f=e.afterCount,k=e.beforeCount,l=e.canViewerComment,m=e.commentIDs,n=e.commentsByID,p=e.feedbackTargetID,s=e.hasNext,t=e.hasPrevious,u=e.hiddenCommentIDs,v=e.initiallyExpanded,w=e.isListVisible,x=e.pageSize,y=e.shouldRenderComposerPreemptively,z=e.topLevelFeedbackTargetID,A=e.totalCount;e=e.viewOption;d={backward:g({count:k,direction:"backward",error:null,hasMore:t,isLoading:(d=c==null?void 0:(d=c.pagers)==null?void 0:(d=d.backward)==null?void 0:(d=d.status)==null?void 0:d.pending)!=null?d:!1,pageSize:x,totalCount:A}),forward:g({count:f,direction:"forward",error:null,hasMore:s,isLoading:(d=c==null?void 0:(d=c.pagers)==null?void 0:(d=d.forward)==null?void 0:(d=d.status)==null?void 0:d.pending)!=null?d:!1,pageSize:x,totalCount:A})};var da={};u.forEach(function(a){da[a]="COLLAPSED"});u={canViewerComment:l,commentPages:m.length>0?[{__type:"COMMENTS_PAGE",afterCount:f,beforeCount:k,commentIDs:m,hasNext:s,hasPrevious:t,state:"VISIBLE"}]:[],commentsByID:n,commentsHiddenByViewer:da,expanded:(x=c==null?void 0:c.expanded)!=null?x:v,feedbackTargetID:p,hasPaged:{backward:!1,forward:!1},isListVisible:w,locallyComposedCommentIDs:[],newCommentsPage:{__type:"NEW_COMMENTS_PAGE",commentIDs:[],visibleStates:{}},pagers:d,shouldComposerRenderWhenListIsExpanded:y,topLevelFeedbackTargetID:z,viewOption:e};if(a.args.depth===0)return babelHelpers["extends"]({},u,{__type:"DEPTH_0",status:{error:null,pending:!1}});l=a.args.minCountToShowCollapser;f=null;c!=null&&c.__type==="DEPTH_1"&&(f=c.repliesExpander);return babelHelpers["extends"]({},u,{__type:"DEPTH_1",repliesCollapser:h({count:m.length,expanded:v,minCountToShowCollapser:l}),repliesExpander:i({error:null,expanded:(k=c==null?void 0:c.expanded)!=null?k:v,isLoading:(n=(s=f)==null?void 0:(t=s.status)==null?void 0:t.pending)!=null?n:!1,totalCount:A})})}if(c==null)throw b("unrecoverableViolation")("Expected state not to be null","ufi2");switch(a.__type){case"COLLAPSE_LIST":x=a.args;p=x.depth;w=x.totalCount;if(c.expanded===!1)return c;if(c.__type==="DEPTH_0")return babelHelpers["extends"]({},c,{expanded:!1});d=r.getCommentsCount({depth:p,state:c})===0;y=w>0&&d===!0;y&&b("FBLogger")("ufi2").warn("UFI2CommentsListState.updater(...): COLLAPSE_LIST: expected list not to be empty if connection is not empty");return babelHelpers["extends"]({},c,{expanded:!1,repliesCollapser:null,repliesExpander:i({error:c.repliesExpander?c.repliesExpander.status.error:null,expanded:!1,isLoading:!1,totalCount:w})});case"DELETE_COMMENT":z=a.args;var B=z.commentID;e=z.depth;u=c.commentPages;m=c.locallyComposedCommentIDs;var C=c.newCommentsPage;if(u.length===0&&C.commentIDs.length===0)return c;l=C.commentIDs.filter(function(a){return a!==B});k=r.getVisibleCommentsCount({depth:e,state:c});v=l.length<C.commentIDs.length;if(v){var ea={};l.forEach(function(a){ea[a]=C.visibleStates[a]});f=babelHelpers["extends"]({},C,{commentIDs:l,visibleStates:ea});s=u.map(function(a){return j({direction:"backward",page:a})});if(c.__type==="DEPTH_0")return babelHelpers["extends"]({},c,{__type:"DEPTH_0",commentPages:s,newCommentsPage:f});if(a.args.depth===0)throw b("unrecoverableViolation")("CometUFICommentList.updater(...): depth should be 1 or greater","ufi2");t=a.args.minCountToShowCollapser;return babelHelpers["extends"]({},c,{__type:"DEPTH_1",commentPages:s,newCommentsPage:f,repliesCollapser:h({count:k-1,expanded:c.expanded,minCountToShowCollapser:t})})}var D=null,E=!1;n=u.map(function(a,b){if(E)return j({direction:"backward",page:a});var c=a.commentIDs.filter(function(a){return a!==B});if(c.length<a.commentIDs.length){E=!0;D=b;return babelHelpers["extends"]({},a,{commentIDs:c})}return a}).map(function(a,b){return a&&D!=null&&b<D?j({direction:"forward",page:a}):a}).filter(Boolean);if(E===!1){b("FBLogger")("ufi2").warn("CometUFICommentListState.updater(...): Tried deleting a comment that isnt present");return c}A=m.filter(function(a){return a!==B});if(c.__type==="DEPTH_0")return babelHelpers["extends"]({},c,{__type:"DEPTH_0",commentPages:n,locallyComposedCommentIDs:A});if(a.args.depth===0)throw b("unrecoverableViolation")("CometUFICommentList.updater(...): depth should be 1 or greater","ufi2");return babelHelpers["extends"]({},c,{__type:"DEPTH_1",commentPages:n,locallyComposedCommentIDs:A,repliesCollapser:h({count:k-1,expanded:c.expanded,minCountToShowCollapser:a.args.minCountToShowCollapser})});case"EXPAND_HIDDEN_COMMENTS":x=a.args.commentIDs;var fa=c.commentsHiddenByViewer,F=babelHelpers["extends"]({},fa);x.forEach(function(a){var c=fa[a];if(c==null){b("FBLogger")("ufi2").warn("CometUFICommentListState.updater(...): Tried expanding a comment that is not hidden");return}c==="COLLAPSED"&&(F[a]="EXPANDED")});return c.__type==="DEPTH_0"?babelHelpers["extends"]({},c,{__type:"DEPTH_0",commentsHiddenByViewer:F}):babelHelpers["extends"]({},c,{__type:"DEPTH_1",commentsHiddenByViewer:F});case"EXPAND_LIST":p=a.args;d=p.depth;y=p.totalCount;w=c.commentPages;z=c.newCommentsPage;if(c.expanded===!0&&c.shouldComposerRenderWhenListIsExpanded===!0)return c;if(d!==0&&r.isRepliesExpanderLoading({depth:d,state:c}))return c;if(y===0)return c.__type==="DEPTH_0"?babelHelpers["extends"]({},c,{__type:"DEPTH_0",expanded:!0,shouldComposerRenderWhenListIsExpanded:!0}):babelHelpers["extends"]({},c,{__type:"DEPTH_1",expanded:!0,repliesCollapser:null,repliesExpander:null,shouldComposerRenderWhenListIsExpanded:!0});e=r.getVisibleCommentsCount({depth:d,state:c});if(e===0){v=r.getCommentsCount({depth:d,state:c})===0;if(v)return c.__type==="DEPTH_0"?babelHelpers["extends"]({},c,{__type:"DEPTH_0",expanded:!0,shouldComposerRenderWhenListIsExpanded:!0,status:{error:null,pending:!0}}):babelHelpers["extends"]({},c,{__type:"DEPTH_1",expanded:!1,repliesCollapser:null,repliesExpander:i({error:null,expanded:!1,isLoading:!0,totalCount:y})});l=w.length>0?w[0]:null;s=l!=null?[babelHelpers["extends"]({},l,{state:"VISIBLE"})].concat(w.slice(1)):w;var ga={};z.commentIDs.forEach(function(a){ga[a]="VISIBLE"});f=babelHelpers["extends"]({},z,{visibleStates:ga});if(c.__type==="DEPTH_0")return babelHelpers["extends"]({},c,{__type:"DEPTH_0",commentPages:s,expanded:!0,newCommentsPage:f,shouldComposerRenderWhenListIsExpanded:!0});if(a.args.depth===0)throw b("unrecoverableViolation")("CometUFICommentList.updater(...): depth should be 1 or greater","ufi2");t=(l!=null?l.commentIDs.length:0)+z.commentIDs.length;return babelHelpers["extends"]({},c,{__type:"DEPTH_1",commentPages:s,expanded:!0,newCommentsPage:f,repliesCollapser:h({count:t,expanded:!0,minCountToShowCollapser:a.args.minCountToShowCollapser}),repliesExpander:null,shouldComposerRenderWhenListIsExpanded:!0})}if(c.__type==="DEPTH_0")return babelHelpers["extends"]({},c,{__type:"DEPTH_0",expanded:!0,shouldComposerRenderWhenListIsExpanded:!0});if(a.args.depth===0)throw b("unrecoverableViolation")("CometUFICommentList.updater(...): depth should be 1 or greater","ufi2");return babelHelpers["extends"]({},c,{__type:"DEPTH_1",expanded:!0,repliesCollapser:h({count:e,expanded:!0,minCountToShowCollapser:a.args.minCountToShowCollapser}),repliesExpander:null,shouldComposerRenderWhenListIsExpanded:!0});case"HIDE_COMMENTS":u=a.args.commentIDs;m=c.commentsHiddenByViewer;var G=babelHelpers["extends"]({},m);u.forEach(function(a){G[a]="LOCALLY_HIDDEN"});return c.__type==="DEPTH_0"?babelHelpers["extends"]({},c,{__type:"DEPTH_0",commentsHiddenByViewer:G}):babelHelpers["extends"]({},c,{__type:"DEPTH_1",commentsHiddenByViewer:G});case"RECEIVE_COMMENTS_PAGE":n=c.commentPages;A=c.locallyComposedCommentIDs;var H=c.newCommentsPage;k=c.pagers;x=a.args;var I=x.commentIDs;p=x.depth;d=x.direction;v=x.feedbackTargetID;y=x.hiddenCommentIDs;w=x.pageSize;var J=r.isPagerLoading({depth:p,direction:d,state:c})===!0;l=p!==0&&r.isRepliesExpanderLoading({depth:p,state:c});var ha=p===0&&!J;z=H.commentIDs.filter(function(a){return!(I.includes(a)&&(!ha||H.visibleStates[a]==="HIDDEN"))});s=A.filter(function(a){return!I.includes(a)});var K={};z.forEach(function(a){K[a]=H.visibleStates[a]});f=babelHelpers["extends"]({},H,{commentIDs:z,visibleStates:K});var ia=new Set(n.reduce(function(a,b){return a.concat(b.commentIDs)},[]).concat(ha?z:[]));t=I.filter(function(a){return!ia.has(a)});d==="forward"&&a.args.hasNext===!0&&a.args.afterCount===0&&b("FBLogger")("ufi2").addMetadata("UFI","FEEDBACK_TARGET_ID",v).warn("CometUFICommentListState.receiveCommentsPage: Received page of comments that has_next_page but after_count is 0");a.args.direction==="forward"&&a.args.hasNext===!1&&a.args.afterCount>0&&b("FBLogger")("ufi2").addMetadata("UFI","FEEDBACK_TARGET_ID",v).warn("CometUFICommentListState.receiveCommentsPage: Received page of comments that does NOT have next_page but after_count is > 0");a.args.direction==="backward"&&a.args.hasPrevious===!0&&a.args.beforeCount===0&&b("FBLogger")("ufi2").addMetadata("UFI","FEEDBACK_TARGET_ID",v).warn("CometUFICommentListState.receiveCommentsPage: Received page of comments that has_previous_page but before_count is 0");a.args.direction==="backward"&&a.args.hasPrevious===!1&&a.args.beforeCount>0&&b("FBLogger")("ufi2").addMetadata("UFI","FEEDBACK_TARGET_ID",v).warn("CometUFICommentListState.receiveCommentsPage: Received page of comments that does NOT have previous_page but before_count is > 0");e=c.shouldComposerRenderWhenListIsExpanded===!0||J===!0||l===!0;var L=babelHelpers["extends"]({},c.commentsHiddenByViewer);y.forEach(function(a){Object.prototype.hasOwnProperty.call(L,a)||(L[a]="COLLAPSED")});m=ia.size;if(p!==0&&a.args.direction==="forward"&&m===0){u=a.args;x=u.afterCount;A=u.hasNext;d={backward:null,forward:g({count:x,direction:"forward",error:null,hasMore:A,isLoading:!1,pageSize:w})};var M=c.expanded||l?"VISIBLE":"HIDDEN";v={__type:"COMMENTS_PAGE",afterCount:x,beforeCount:z.length,commentIDs:t,hasNext:A,hasPrevious:!1,state:M};z.forEach(function(a){K[a]=M});f=babelHelpers["extends"]({},H,{commentIDs:z,visibleStates:K});if(a.args.depth===0)throw b("unrecoverableViolation")("CometUFICommentList.updater(...): depth should be 1 or greater","ufi2");if(c.__type!=="DEPTH_1")throw b("unrecoverableViolation")("CometUFICommentList.updater(...): depth should be 1 or greater","ufi2");y=a.args.minCountToShowCollapser;return babelHelpers["extends"]({},c,{__type:"DEPTH_1",commentPages:[v],commentsHiddenByViewer:L,expanded:M==="VISIBLE",locallyComposedCommentIDs:s,newCommentsPage:f,pagers:d,repliesCollapser:h({count:t.length,expanded:l,minCountToShowCollapser:y}),repliesExpander:l?null:c.repliesExpander,shouldComposerRenderWhenListIsExpanded:e})}m=n[0];u=n[n.length-1];x=r.getVisibleCommentsCount({depth:p,state:c});if(a.args.direction==="backward"){if(J&&m!=null&&m.state!=="VISIBLE")throw b("unrecoverableViolation")("Expected first available page to be visible if backward pager was loading when backward comments were received","ufi2");A=a.args;v=A.beforeCount;d=A.hasPrevious;y=v<=z.length;y&&(K={},f.commentIDs.forEach(function(a){K[a]=J?"VISIBLE":"HIDDEN"}),f=babelHelpers["extends"]({},f,{visibleStates:K}));p=v-f.commentIDs.length-s.length;A=babelHelpers["extends"]({},k,{backward:J?g({count:p,direction:"backward",error:null,hasMore:d&&!y,isLoading:!1,pageSize:w}):k.backward});m={__type:"COMMENTS_PAGE",afterCount:((z=m==null?void 0:m.afterCount)!=null?z:0)+((z=m==null?void 0:(p=m.commentIDs)==null?void 0:p.length)!=null?z:0),beforeCount:v,commentIDs:t,hasNext:!0,hasPrevious:d,state:J||l?"VISIBLE":"HIDDEN"};if(c.__type==="DEPTH_0")return babelHelpers["extends"]({},c,{__type:"DEPTH_0",commentPages:[m].concat(n),commentsHiddenByViewer:L,locallyComposedCommentIDs:s,newCommentsPage:f,pagers:A,shouldComposerRenderWhenListIsExpanded:e});if(a.args.depth===0)throw b("unrecoverableViolation")("CometUFICommentList.updater(...): depth should be 1 or greater","ufi2");p=a.args.minCountToShowCollapser;z=l?!0:c.expanded;v=x+(m.state==="VISIBLE"?t.length:0)+(y&&J?f.commentIDs.length:0);return babelHelpers["extends"]({},c,{__type:"DEPTH_1",commentPages:[m].concat(n),commentsHiddenByViewer:L,expanded:z,locallyComposedCommentIDs:s,newCommentsPage:f,pagers:A,repliesCollapser:h({count:v,expanded:z,minCountToShowCollapser:p}),repliesExpander:l?null:c.repliesExpander,shouldComposerRenderWhenListIsExpanded:e})}if(J&&u!=null&&u.state!=="VISIBLE")throw b("unrecoverableViolation")("Expected last available page to be visible if forward pager was loading when forward comments were received","ufi2");d=a.args;y=d.afterCount;m=d.hasNext;A=babelHelpers["extends"]({},k,{forward:J?g({count:y,direction:"forward",error:null,hasMore:m,isLoading:!1,pageSize:w}):k.forward});d={__type:"COMMENTS_PAGE",afterCount:y,beforeCount:((v=u==null?void 0:u.beforeCount)!=null?v:0)+((p=u==null?void 0:(z=u.commentIDs)==null?void 0:z.length)!=null?p:0),commentIDs:t,hasNext:m,hasPrevious:!0,state:J||l?"VISIBLE":"HIDDEN"};var N=0;w=l?n.map(function(a){a.state==="HIDDEN"&&(N+=a.commentIDs.length);return babelHelpers["extends"]({},a,{state:"VISIBLE"})}):n;if(c.__type==="DEPTH_0")return babelHelpers["extends"]({},c,{__type:"DEPTH_0",commentPages:[].concat(w,[d]),commentsHiddenByViewer:L,locallyComposedCommentIDs:s,newCommentsPage:f,pagers:A,shouldComposerRenderWhenListIsExpanded:e});if(a.args.depth===0)throw b("unrecoverableViolation")("CometUFICommentList.updater(...): depth should be 1 or greater","ufi2");k=a.args.minCountToShowCollapser;y=d.state==="VISIBLE"?x+N+t.length:x+N;v=l?!0:c.expanded;return babelHelpers["extends"]({},c,{__type:"DEPTH_1",commentPages:[].concat(w,[d]),commentsHiddenByViewer:L,expanded:v,locallyComposedCommentIDs:s,newCommentsPage:f,pagers:A,repliesCollapser:h({count:y,expanded:v,minCountToShowCollapser:k}),repliesExpander:l?null:c.repliesExpander,shouldComposerRenderWhenListIsExpanded:e});case"RECEIVE_NEW_COMMENT":u=a.args;var O=u.commentID;z=u.depth;p=u.pageSize;m=u.prevTotalCount;n=u.totalCount;t=c.commentPages;x=c.commentsByID;w=c.expanded;d=c.locallyComposedCommentIDs;var P=c.newCommentsPage;s=c.pagers;f=c.viewOption;A=r.getCommentsCount({depth:z,state:c})===0;y=Object.prototype.hasOwnProperty.call(P.visibleStates,O)||t.some(function(a){return a.commentIDs.includes(O)});if(y)return c;v=x[O]!=null&&x[O].is_locally_composed===!0;var Q=!b("UFI2ViewOption").isChronologicalOrder(f)&&c.__type!=="DEPTH_0";k=c.repliesExpander!=null?babelHelpers["extends"]({},c.repliesExpander,{count:Math.min(c.repliesExpander.count+1,n)}):null;var R=(e=(l=x[O])==null?void 0:l.reply_comment_parent_fbid)!=null?e:(u=x[O])==null?void 0:(y=u.reply_parent_comment)==null?void 0:y.id;if(c.__type!=="DEPTH_0"&&a.args.depth!==0&&f==="RANKED_SUB_REPLIES"&&(R!=null||t.length===0)){var S=!1;l=t.map(function(a){if(!S&&R!=null){var b=a.commentIDs.indexOf(R);if(b>=0){S=!0;var c=[].concat(a.commentIDs);c.splice(b+1,0,O);return babelHelpers["extends"]({},a,{commentIDs:c})}}return a});e=P;if(!S&&R!=null||l.length===0){x=R!=null?P.commentIDs.indexOf(R):-1;u=[].concat(P.commentIDs);x>=0?u.splice(x,0,O):u.unshift(O);e=babelHelpers["extends"]({},P,{commentIDs:u,visibleStates:babelHelpers["extends"]({},P.visibleStates,(y={},y[O]="VISIBLE",y))});S=!0}f=v?[O].concat(d):d;if(S)return babelHelpers["extends"]({},c,{__type:"DEPTH_1",commentPages:l,locallyComposedCommentIDs:f,newCommentsPage:e})}if(t.length===0){u=babelHelpers["extends"]({},P,{commentIDs:[O].concat(P.commentIDs),visibleStates:babelHelpers["extends"]({},P.visibleStates,(x={},x[O]=w||v||z!==0&&A&&m===0?"VISIBLE":"HIDDEN",x))});y=v?[O].concat(d):d;if(c.__type==="DEPTH_0")return babelHelpers["extends"]({},c,{__type:"DEPTH_0",locallyComposedCommentIDs:y,newCommentsPage:u});if(a.args.depth===0)throw b("unrecoverableViolation")("CometUFICommentList.updater(...): depth should be 1 or greater","ufi2");l=a.args.minCountToShowCollapser;f=A&&m===0?!0:w;return babelHelpers["extends"]({},c,{__type:"DEPTH_1",expanded:f,locallyComposedCommentIDs:y,newCommentsPage:u,repliesCollapser:h({count:u.commentIDs.length,expanded:w,minCountToShowCollapser:l}),repliesExpander:k,shouldComposerRenderWhenListIsExpanded:!0})}e=t[0];x=o(c);A=z===0&&r.hasMoreInDirection({depth:z,direction:"forward",state:c,totalCount:n})&&!c.commentPages.some(function(a){return a.state==="VISIBLE"});if(!A&&v){var T=!1,U=babelHelpers["extends"]({},P.visibleStates),ja=[],V=[];f=(Q?[].concat(t).reverse():t).map(function(a){if(!T&&a.state==="VISIBLE"){T=!0;P.commentIDs.forEach(function(a){U[a]==="VISIBLE"?(delete U[a],V.push(a)):ja.push(a)});return babelHelpers["extends"]({},a,{commentIDs:Q?[].concat(a.commentIDs,V.reverse(),[O]):[O].concat(V,a.commentIDs)})}return T?babelHelpers["extends"]({},a,{afterCount:Q?a.afterCount+1+V.length:a.afterCount,beforeCount:Q?a.beforeCount:a.beforeCount+1+V.length}):a});y=babelHelpers["extends"]({},P,{commentIDs:ja,visibleStates:U});u=[O].concat(d);if(c.__type==="DEPTH_0")return babelHelpers["extends"]({},c,{__type:"DEPTH_0",commentPages:f,locallyComposedCommentIDs:u,newCommentsPage:y});if(a.args.depth===0)throw b("unrecoverableViolation")("CometUFICommentList.updater(...): depth should be 1 or greater","ufi2");l=a.args.minCountToShowCollapser;var W=r.getVisibleCommentsCount({depth:z,state:c});return babelHelpers["extends"]({},c,{__type:"DEPTH_1",commentPages:Q?f.reverse():f,locallyComposedCommentIDs:u,newCommentsPage:y,repliesCollapser:h({count:W+1,expanded:w,minCountToShowCollapser:l}),repliesExpander:k,shouldComposerRenderWhenListIsExpanded:!0})}else if(A){u={commentPages:t.map(function(a,b){return b===0?babelHelpers["extends"]({},a,{beforeCount:a.beforeCount+1,hasPrevious:!0}):a}),locallyComposedCommentIDs:v?[O].concat(d):d,newCommentsPage:babelHelpers["extends"]({},P,{commentIDs:[O].concat(P.commentIDs),visibleStates:babelHelpers["extends"]({},P.visibleStates,(f={},f[O]="VISIBLE",f))})};return c.__type==="DEPTH_0"?babelHelpers["extends"]({},c,u,{__type:"DEPTH_0"}):babelHelpers["extends"]({},c,u,{__type:"DEPTH_1"})}else if(x&&ba(c)){y=t.map(function(a){return babelHelpers["extends"]({},a,{beforeCount:a.beforeCount+1})});l=babelHelpers["extends"]({},P,{commentIDs:[O].concat(P.commentIDs),visibleStates:babelHelpers["extends"]({},P.visibleStates,(W={},W[O]="VISIBLE",W))});if(c.__type==="DEPTH_0")return babelHelpers["extends"]({},c,{__type:"DEPTH_0",commentPages:y,newCommentsPage:l});if(a.args.depth===0)throw b("unrecoverableViolation")("CometUFICommentList.updater(...): depth should be 1 or greater","ufi2");A=a.args.minCountToShowCollapser;v=r.getVisibleCommentsCount({depth:z,state:c});return babelHelpers["extends"]({},c,{__type:"DEPTH_1",commentPages:y,newCommentsPage:l,repliesCollapser:h({count:v+1,expanded:w,minCountToShowCollapser:A}),repliesExpander:k,shouldComposerRenderWhenListIsExpanded:!0})}else if(x&&P.commentIDs.length===0){d=s.backward!=null?babelHelpers["extends"]({},s,{backward:babelHelpers["extends"]({},s.backward,{count:Math.min(s.backward.count+1,p)})}):s;f=e.commentIDs.length<p;if(f){u=[babelHelpers["extends"]({},e,{commentIDs:[O].concat(e.commentIDs)})].concat(t.slice(1).map(function(a){return babelHelpers["extends"]({},a,{beforeCount:a.beforeCount+1})}));return c.__type==="DEPTH_0"?babelHelpers["extends"]({},c,{__type:"DEPTH_0",commentPages:u,pagers:d}):babelHelpers["extends"]({},c,{__type:"DEPTH_1",commentPages:u,pagers:d,repliesExpander:k})}W=[{__type:"COMMENTS_PAGE",afterCount:e.afterCount+e.commentIDs.length,beforeCount:0,commentIDs:[O],hasNext:!0,hasPrevious:!1,state:"HIDDEN"},babelHelpers["extends"]({},e,{beforeCount:1,hasPrevious:!0})].concat(t.slice(1).map(function(a){return babelHelpers["extends"]({},a,{beforeCount:a.beforeCount+1})}));return c.__type==="DEPTH_0"?babelHelpers["extends"]({},c,{__type:"DEPTH_0",commentPages:W,pagers:d}):babelHelpers["extends"]({},c,{__type:"DEPTH_1",commentPages:W,pagers:d,repliesExpander:k})}else{z=n<=m;y=z?t:t.map(function(a){return babelHelpers["extends"]({},a,{beforeCount:a.beforeCount+1,hasPrevious:!0})});l=s.backward!=null?babelHelpers["extends"]({},s,{backward:babelHelpers["extends"]({},s.backward,{count:z?s.backward.count:Math.min(s.backward.count+1,p)})}):s;w=babelHelpers["extends"]({},P,{commentIDs:[O].concat(P.commentIDs),visibleStates:babelHelpers["extends"]({},P.visibleStates,(v={},v[O]="HIDDEN",v))});return c.__type==="DEPTH_0"?babelHelpers["extends"]({},c,{__type:"DEPTH_0",commentPages:y,newCommentsPage:w,pagers:l}):babelHelpers["extends"]({},c,{__type:"DEPTH_1",commentPages:y,newCommentsPage:w,pagers:l,repliesExpander:k})}case"RECEIVE_REALTIME_COMMENT":var X=a.args.commentID;A=Object.prototype.hasOwnProperty.call(c.newCommentsPage.visibleStates,X)||c.commentPages.some(function(a){return a.commentIDs.includes(X)});if(!b("UFI2ViewOption").isChronologicalOrder(c.viewOption)){b("recoverableViolation")("Unable to receive realtime comment for non chronological ordering mode "+((x=c.viewOption)!=null?x:"(null ordering mode)"),"ufi2");return c}if(A)return c;f=r.getCommentsCount({depth:a.args.depth,state:c})===0;u=q(c).length===0;e=!a.args.hideCommentInPager&&f&&c.__type==="DEPTH_1";W=a.args.hideCommentInPager||!c.expanded&&!e||!f&&!ba(c);d=W===!0&&!(u&&c.pagers.forward!=null);n=W&&!d;p={canViewerComment:c.canViewerComment,commentPages:c.commentPages.map(function(a){return babelHelpers["extends"]({},a,{beforeCount:a.beforeCount+1,hasPrevious:!0})}),commentsByID:c.commentsByID,commentsHiddenByViewer:c.commentsHiddenByViewer,expanded:c.expanded||e,feedbackTargetID:c.feedbackTargetID,hasPaged:c.hasPaged,locallyComposedCommentIDs:c.locallyComposedCommentIDs,newCommentsPage:babelHelpers["extends"]({},c.newCommentsPage,{commentIDs:[X].concat(c.newCommentsPage.commentIDs),visibleStates:babelHelpers["extends"]({},c.newCommentsPage.visibleStates,(m={},m[X]=W?"HIDDEN":"VISIBLE",m))}),pagers:W?{backward:d?{__type:"PAGER",count:((p=(t=c.pagers)==null?void 0:(z=t.backward)==null?void 0:z.count)!=null?p:0)+1,direction:"backward",status:{error:(y=(s=c.pagers)==null?void 0:(v=s.backward)==null?void 0:v.status.error)!=null?y:null,pending:(k=(w=c.pagers)==null?void 0:(l=w.backward)==null?void 0:l.status.pending)!=null?k:!1}}:c.pagers.backward,forward:n?{__type:"PAGER",count:((f=(x=c.pagers)==null?void 0:(A=x.forward)==null?void 0:A.count)!=null?f:0)+1,direction:"forward",status:{error:(m=(u=c.pagers)==null?void 0:(e=u.forward)==null?void 0:e.status.error)!=null?m:null,pending:(z=(d=c.pagers)==null?void 0:(t=d.forward)==null?void 0:t.status.pending)!=null?z:!1}}:c.pagers.forward}:c.pagers,shouldComposerRenderWhenListIsExpanded:c.shouldComposerRenderWhenListIsExpanded,topLevelFeedbackTargetID:c.topLevelFeedbackTargetID,viewOption:c.viewOption};if(c.__type==="DEPTH_1"){return babelHelpers["extends"]({},c,p,{repliesCollapser:h({count:r.getVisibleCommentsCount({depth:a.args.depth,state:c})+(W?0:1),expanded:c.expanded,minCountToShowCollapser:b("UFI2CommentsConfig").minRepliesToToggleReplies}),repliesExpander:i({error:(y=(s=c.repliesExpander)==null?void 0:(v=s.status)==null?void 0:v.error)!=null?y:null,expanded:c.expanded,isLoading:(k=(w=c.repliesExpander)==null?void 0:(l=w.status)==null?void 0:l.pending)!=null?k:!1,totalCount:a.args.totalCount})})}return c.__type==="DEPTH_0"?babelHelpers["extends"]({},c,p):c;case"RECEIVE_REFETCH_LIST":n=a.args.depth;x=c.feedbackTargetID;A=c.topLevelFeedbackTargetID;f=c.viewOption;if(n!==0)throw b("unrecoverableViolation")("Expected depth to be 0 for RECEIVE_REFETCH_LIST","ufi2");if(!r.isListLoading({depth:n,state:c}))throw b("unrecoverableViolation")("Expected list to be loading","ufi2");u=aa.getInitialState({args:babelHelpers["extends"]({},a.args,{depth:0,feedbackTargetID:x,initiallyExpanded:!0,topLevelFeedbackTargetID:A,viewOption:f}),state:null});if(u.__type!=="DEPTH_0")throw b("unrecoverableViolation")("Expected depth to be 0 for RECEIVE_REFETCH_LIST","ufi2");return babelHelpers["extends"]({},u,{__type:"DEPTH_0",expanded:c.expanded,status:{error:null,pending:!1}});case"REQUEST_COMMENTS_PAGE":e=a.args;m=e.depth;d=e.direction;t=e.pageSize;z=c.commentPages;W=c.expanded;s=c.newCommentsPage;v=c.pagers;if(!W)throw b("unrecoverableViolation")("Expected list to be expanded","ufi2");if(r.isPagerLoading({depth:m,direction:d,state:c}))throw b("unrecoverableViolation")("Cant request page if pager is loading","ufi2");if(m===0&&r.isListLoading({depth:m,state:c}))throw b("unrecoverableViolation")("Cant request page if list is loading","ufi2");if(m!==0&&r.isRepliesExpanderLoading({depth:m,state:c}))throw b("unrecoverableViolation")("Cant request page if replies expander is loading","ufi2");if(d==="backward"){y=z.findIndex(function(a){return a.state==="VISIBLE"});w=-1;if(y>-1){l=z[y];l.hasPrevious===!1&&b("FBLogger")("ufi2").mustfix("CometUFICommentList.updater(...): REQUEST_COMMENTS_PAGE - Can't request previous comments if there are no more comments available, feedbackID: %s",c.topLevelFeedbackTargetID);if(l.hasPrevious!==!0)throw b("unrecoverableViolation")("Can't request previous comments if there are no more comments available","ufi2");w=y-1}else y===-1&&z.length>0&&(w=0);k=z[w];p=o(c)&&ca(c,"HIDDEN");if(k&&k.state==="HIDDEN"){n=[].concat(z);n[w]=babelHelpers["extends"]({},k,{state:"VISIBLE"});x=babelHelpers["extends"]({},v,{backward:g({count:k.beforeCount,direction:"backward",error:null,hasMore:k.hasPrevious,isLoading:!1,pageSize:t})});if(c.__type==="DEPTH_0")return babelHelpers["extends"]({},c,{__type:"DEPTH_0",commentPages:n,hasPaged:babelHelpers["extends"]({},c.hasPaged,{backward:!0}),pagers:x,shouldComposerRenderWhenListIsExpanded:!0});if(a.args.depth===0)throw b("unrecoverableViolation")("CometUFICommentList.updater(...): depth should be 1 or greater","ufi2");A=a.args.minCountToShowCollapser;f=r.getVisibleCommentsCount({depth:m,state:c});return babelHelpers["extends"]({},c,{__type:"DEPTH_1",commentPages:n,hasPaged:babelHelpers["extends"]({},c.hasPaged,{backward:!0}),pagers:x,repliesCollapser:h({count:f+k.commentIDs.length,expanded:c.expanded,minCountToShowCollapser:A}),shouldComposerRenderWhenListIsExpanded:!0})}else if(p){var ka={};s.commentIDs.forEach(function(a){ka[a]="VISIBLE"});u=babelHelpers["extends"]({},s,{visibleStates:ka});e=babelHelpers["extends"]({},v,{backward:null});if(c.__type==="DEPTH_0")return babelHelpers["extends"]({},c,{__type:"DEPTH_0",hasPaged:babelHelpers["extends"]({},c.hasPaged,{backward:!0}),newCommentsPage:u,pagers:e,shouldComposerRenderWhenListIsExpanded:!0});if(a.args.depth===0)throw b("unrecoverableViolation")("CometUFICommentList.updater(...): depth should be 1 or greater","ufi2");W=a.args.minCountToShowCollapser;d=r.getVisibleCommentsCount({depth:m,state:c});return babelHelpers["extends"]({},c,{__type:"DEPTH_1",hasPaged:babelHelpers["extends"]({},c.hasPaged,{backward:!0}),newCommentsPage:u,pagers:e,repliesCollapser:h({count:d+u.commentIDs.length,expanded:c.expanded,minCountToShowCollapser:W}),shouldComposerRenderWhenListIsExpanded:!0})}else{l=babelHelpers["extends"]({},v,{backward:babelHelpers["extends"]({},v.backward,{status:{error:null,pending:!0}})});return c.__type==="DEPTH_0"?babelHelpers["extends"]({},c,{__type:"DEPTH_0",hasPaged:babelHelpers["extends"]({},c.hasPaged,{backward:!0}),pagers:l}):babelHelpers["extends"]({},c,{__type:"DEPTH_1",hasPaged:babelHelpers["extends"]({},c.hasPaged,{backward:!0}),pagers:l})}}y=[].concat(z).reverse().findIndex(function(a){return a.state==="VISIBLE"});w=-1;if(y>-1){n=z.length-1-y;x=z[n];if(x.hasNext!==!0)throw b("unrecoverableViolation")("Can't request previous comments if there are no more comments available","ufi2");w=n+1}else y===-1&&z.length>0&&(w=z.length-1);f=z[w];if(f&&f.state==="HIDDEN"){k=[].concat(z);k[w]=babelHelpers["extends"]({},f,{state:"VISIBLE"});A=babelHelpers["extends"]({},v,{forward:g({count:f.afterCount,direction:"forward",error:null,hasMore:f.hasNext,isLoading:!1,pageSize:t})});if(c.__type==="DEPTH_0")return babelHelpers["extends"]({},c,{__type:"DEPTH_0",commentPages:k,hasPaged:babelHelpers["extends"]({},c.hasPaged,{forward:!0}),pagers:A,shouldComposerRenderWhenListIsExpanded:!0});if(a.args.depth===0)throw b("unrecoverableViolation")("CometUFICommentList.updater(...): depth should be 1 or greater","ufi2");p=a.args.minCountToShowCollapser;s=r.getVisibleCommentsCount({depth:m,state:c});return babelHelpers["extends"]({},c,{__type:"DEPTH_1",commentPages:k,hasPaged:babelHelpers["extends"]({},c.hasPaged,{forward:!0}),pagers:A,repliesCollapser:h({count:s+f.commentIDs.length,expanded:c.expanded,minCountToShowCollapser:p}),shouldComposerRenderWhenListIsExpanded:!0})}else{e=babelHelpers["extends"]({},v,{forward:babelHelpers["extends"]({},v.forward,{status:{error:null,pending:!0}})});return c.__type==="DEPTH_0"?babelHelpers["extends"]({},c,{__type:"DEPTH_0",hasPaged:babelHelpers["extends"]({},c.hasPaged,{forward:!0}),pagers:e}):babelHelpers["extends"]({},c,{__type:"DEPTH_1",hasPaged:babelHelpers["extends"]({},c.hasPaged,{forward:!0}),pagers:e})}case"REQUEST_REFETCH_LIST":d=a.args.depth;if(d!==0||c.__type!=="DEPTH_0")throw b("unrecoverableViolation")("Expected depth to be 0 for RECEIVE_REFETCH_LIST","ufi2");if(r.isListLoading({depth:d,state:c}))throw b("unrecoverableViolation")("Expected list to be loading","ufi2");return babelHelpers["extends"]({},c,{__type:"DEPTH_0",commentPages:[],expanded:!0,hasPaged:{backward:!1,forward:!1},locallyComposedCommentIDs:[],newCommentsPage:{__type:"NEW_COMMENTS_PAGE",commentIDs:[],visibleStates:{}},pagers:{backward:null,forward:null},status:{error:null,pending:!0}});case"SET_CAN_VIEWER_COMMENT":u=a.args.canViewerComment;return c.__type==="DEPTH_0"?babelHelpers["extends"]({},c,{__type:"DEPTH_0",canViewerComment:u}):babelHelpers["extends"]({},c,{__type:"DEPTH_1",canViewerComment:u});case"SET_COMMENTS_BY_ID":W=a.args.commentsByID;return c.__type==="DEPTH_0"?babelHelpers["extends"]({},c,{__type:"DEPTH_0",commentsByID:W}):babelHelpers["extends"]({},c,{__type:"DEPTH_1",commentsByID:W});case"SET_SERVER_COMMENT_ID":l=a.args;var Y=l.clientCommentID,Z=l.serverCommentID;x=c.commentPages;n=c.locallyComposedCommentIDs;y=c.newCommentsPage;z=y.commentIDs.indexOf(Y);w=z!==-1;t=x.some(function(a){return a.commentIDs.some(function(a){return a===Y})});if(!w&&!t)return c;m=y.commentIDs.some(function(a){return a===Z});k=x.filter(function(a){return a.state==="HIDDEN"}).some(function(a){return a.commentIDs.some(function(a){return a===Z})});A=x.filter(function(a){return a.state==="VISIBLE"}).some(function(a){return a.commentIDs.some(function(a){return a===Z})});s=c;if(k){f=x.map(function(a){var b=a.commentIDs.indexOf(Z);if(b===-1)return a;else return babelHelpers["extends"]({},a,{commentIDs:[].concat(a.commentIDs.slice(0,b),a.commentIDs.slice(b+1))})});s.__type==="DEPTH_0"?s=babelHelpers["extends"]({},s,{__type:"DEPTH_0",commentPages:f}):s=babelHelpers["extends"]({},s,{__type:"DEPTH_1",commentPages:f})}if(m){p=n.filter(function(a){return a===Y});v=y.commentIDs.filter(function(a){return a!==Y});e=babelHelpers["extends"]({},y.visibleStates);delete e[Y];d=babelHelpers["extends"]({},y,{commentIDs:v,visibleStates:e});s.__type==="DEPTH_0"?s=babelHelpers["extends"]({},s,{__type:"DEPTH_0",locallyComposedCommentIDs:p,newCommentsPage:d}):s=babelHelpers["extends"]({},s,{__type:"DEPTH_1",locallyComposedCommentIDs:p,newCommentsPage:d})}if(w){u=babelHelpers["extends"]({},y.visibleStates);if(A||m){W=y.commentIDs.filter(function(a){return a!==Y});delete u[Y];l=babelHelpers["extends"]({},y,{commentIDs:W,visibleStates:u});s.__type==="DEPTH_0"?s=babelHelpers["extends"]({},s,{__type:"DEPTH_0",newCommentsPage:l}):s=babelHelpers["extends"]({},s,{__type:"DEPTH_1",newCommentsPage:l})}else{z=y.commentIDs.map(function(a){return a===Y?Z:a});u[Z]=u[Y];delete u[Y];k=babelHelpers["extends"]({},y,{commentIDs:z,visibleStates:u});s.__type==="DEPTH_0"?s=babelHelpers["extends"]({},s,{__type:"DEPTH_0",newCommentsPage:k}):s=babelHelpers["extends"]({},s,{__type:"DEPTH_1",newCommentsPage:k})}}if(t)if(A||m){f=x.map(function(a){var b=a.commentIDs.indexOf(Y);if(b===-1)return a;else return babelHelpers["extends"]({},a,{commentIDs:[].concat(a.commentIDs.slice(0,b),a.commentIDs.slice(b+1))})});s.__type==="DEPTH_0"?s=babelHelpers["extends"]({},s,{__type:"DEPTH_0",commentPages:f}):s=babelHelpers["extends"]({},s,{__type:"DEPTH_1",commentPages:f})}else{v=x.map(function(a){var b=a.commentIDs.indexOf(Y);if(b===-1)return a;else return babelHelpers["extends"]({},a,{commentIDs:[].concat(a.commentIDs.slice(0,b),[Z],a.commentIDs.slice(b+1))})});s.__type==="DEPTH_0"?s=babelHelpers["extends"]({},s,{__type:"DEPTH_0",commentPages:v}):s=babelHelpers["extends"]({},s,{__type:"DEPTH_1",commentPages:v})}e=n.map(function(a){return a===Y?Z:a});return s.__type==="DEPTH_0"?babelHelpers["extends"]({},s,{__type:"DEPTH_0",locallyComposedCommentIDs:e}):babelHelpers["extends"]({},s,{__type:"DEPTH_1",locallyComposedCommentIDs:e});case"UNHIDE_COMMENTS":p=a.args.commentIDs;d=c.commentsHiddenByViewer;var $=babelHelpers["extends"]({},d);p.forEach(function(a){delete $[a]});return c.__type==="DEPTH_0"?babelHelpers["extends"]({},c,{__type:"DEPTH_0",commentsHiddenByViewer:$}):babelHelpers["extends"]({},c,{__type:"DEPTH_1",commentsHiddenByViewer:$});case"INITIAL_STATE":default:a.__type;throw b("unrecoverableViolation")("CometUFICommentListState: Invalid action type: "+a.__type,"ufi2")}}function m(a,c){try{var d=k(a,c);return d}catch(f){d=b("ErrorNormalizeUtils").normalizeError(f);d=d.message;var e=a.__type==="REQUEST_COMMENTS_PAGE"||a.__type==="RECEIVE_COMMENTS_PAGE"?a.args.direction:"Unknown";b("FBLogger")("ufi2").catching(f).addMetadata("UFI","COMMENTS_LIST_ACTION",a.__type).addMetadata("UFI","COMMENTS_LIST_DEPTH",""+a.args.depth).addMetadata("UFI","COMMENTS_LIST_DIRECTION",e).mustfix("CometUFICommentListState.updater(...): "+d);b("gkx")("676930")&&window.__enableUFI2CommentsListLogging===!0&&a.__type!=="SET_COMMENTS_BY_ID"&&console.groupEnd();if(!c)throw f;return c}}function a(a,b){return k(a,b)}function c(a,b){return k(a,b)}var aa={collapseList:function(a){var b=a.args;a=a.state;return m({__type:"COLLAPSE_LIST",args:b},a)},deleteComment:function(a){var b=a.args;a=a.state;return m({__type:"DELETE_COMMENT",args:b},a)},expandHiddenComments:function(a){var b=a.args;a=a.state;return m({__type:"EXPAND_HIDDEN_COMMENTS",args:b},a)},expandList:function(a){var b=a.args;a=a.state;return m({__type:"EXPAND_LIST",args:b},a)},getInitialState:function(a){var b=a.args;a=a.state;return m({__type:"INITIAL_STATE",args:b},a)},hideComments:function(a){var b=a.args;a=a.state;return m({__type:"HIDE_COMMENTS",args:b},a)},receiveCommentsPage:function(a){var b=a.args;a=a.state;return m({__type:"RECEIVE_COMMENTS_PAGE",args:b},a)},receiveNewComment:function(a){var b=a.args;a=a.state;return m({__type:"RECEIVE_NEW_COMMENT",args:b},a)},receiveRealtimeComment:function(a){var b=a.args;a=a.state;return m({__type:"RECEIVE_REALTIME_COMMENT",args:b},a)},receiveRefetchList:function(a){var b=a.args;a=a.state;return m({__type:"RECEIVE_REFETCH_LIST",args:b},a)},requestCommentsPage:function(a){var b=a.args;a=a.state;return m({__type:"REQUEST_COMMENTS_PAGE",args:b},a)},requestRefetchList:function(a){var b=a.args;a=a.state;return m({__type:"REQUEST_REFETCH_LIST",args:b},a)},setCanViewerComment:function(a){var b=a.args;a=a.state;return m({__type:"SET_CAN_VIEWER_COMMENT",args:b},a)},setCommentsByID:function(a){var b=a.args;a=a.state;return m({__type:"SET_COMMENTS_BY_ID",args:b},a)},setServerCommentID:function(a){var b=a.args;a=a.state;return m({__type:"SET_SERVER_COMMENT_ID",args:b},a)},unhideComments:function(a){var b=a.args;a=a.state;return m({__type:"UNHIDE_COMMENTS",args:b},a)}};function n(a){var b=a.direction;a=a.state;b=b==="forward"?[].concat(a.commentPages).reverse():a.commentPages;return b.find(function(a){return a.state==="VISIBLE"})}function o(a){var b=a.commentPages;a=a.newCommentsPage;b=b[0];return!b?a.commentIDs.length>0:b.beforeCount-a.commentIDs.length===0}function ba(a){var b=a.commentPages;b=b[0];return!b?o(a)&&p(a,"VISIBLE"):o(a)&&b.state==="VISIBLE"&&p(a,"VISIBLE")}function ca(a,b){var c=a.newCommentsPage;return c.commentIDs.some(function(a){return c.visibleStates[a]===b})}function p(a,b){var c=a.newCommentsPage;return c.commentIDs.every(function(a){return c.visibleStates[a]===b})}function q(a){var c=a.__type,d=a.commentPages,e=a.newCommentsPage;a=a.viewOption;c=c==="DEPTH_1"&&!b("UFI2ViewOption").isChronologicalOrder(a);a=d.filter(function(a){return a.state==="VISIBLE"}).reduce(function(a,b){return a.concat(b.commentIDs)},[]);d=e.commentIDs.filter(function(a){return e.visibleStates[a]==="VISIBLE"});return c?[].concat(a,d.reverse()):[].concat(d,a)}var r={canFetchInDirection:function(a){var b=a.depth,c=a.direction,d=a.state;a=a.totalCount;if(a===0)return!1;a=d.commentPages;var e=d.newCommentsPage,f=r.isPagerLoading({depth:b,direction:c,state:d});if(f)return!1;f=b===0&&r.isListLoading({depth:b,state:d});if(f)return!1;f=b!==0&&r.isRepliesExpanderLoading({depth:b,state:d});if(f)return!1;if(a.length===0&&c==="forward")return!0;else if(a.length===0&&c==="backward")return!1;f=a[0];a=a[a.length-1];b=r.getPagerCount({depth:b,direction:"backward",state:d});b=b===e.commentIDs.length&&p(d,"HIDDEN");return c==="backward"?f.state!=="HIDDEN"&&!b&&f.hasPrevious:a.state!=="HIDDEN"&&a.hasNext},getCommentsCount:function(a){a.depth;a=a.state;var b=a.commentPages;a=a.newCommentsPage;return a.commentIDs.concat(b.reduce(function(a,b){return a.concat(b.commentIDs)},[])).length},getCountForFetch:function(a){var c=a.depth,d=a.direction,e=a.pageSize;a=a.state;d=r.getPagerCount({depth:c,direction:d,state:a});if(d!=null)return d;if(c!==0){if(e==null)throw b("unrecoverableViolation")("CometUFICommentListState.getCountForFetch(...): Expected pageSize to compute fetch count for expanding replies","ufi2");d=r.getRepliesExpanderCount({depth:c,state:a});if(d!=null)return Math.min(d,e)}return null},getHiddenStateForComment:function(a){var b=a.commentID;a.depth;a=a.state;a=a.commentsHiddenByViewer;return a[b]||null},getPagerCount:function(a){a.depth;var b=a.direction;a=a.state;a=a.pagers;if(!a)return null;a=a[b];return a!=null?a.count:null},getPagerError:function(a){a.depth;var b=a.direction;a=a.state;a=a.pagers;if(!a)return null;a=a[b];return a!=null?a.status.error:null},getRepliesCollapserCount:function(a){var b=a.depth;a=a.state;if(b===0||a.__type!=="DEPTH_1")return null;b=a.repliesCollapser;return b!=null?b.count:null},getRepliesExpanderCount:function(a){var b=a.depth;a=a.state;if(b===0||a.__type!=="DEPTH_1")return null;b=a.repliesExpander;return b!=null?b.count:null},getRepliesExpanderError:function(a){var b=a.depth;a=a.state;if(b===0||a.__type!=="DEPTH_1")return null;b=a.repliesExpander;return b!=null?b.status.error:null},getVisibleComments:function(a){a.depth;a=a.state;var c=a.commentsByID,d=a.locallyComposedCommentIDs,e=a.newCommentsPage,f=a.viewOption;a=q(a);var g=a.map(function(a){var d=c[a];if(!d){b("FBLogger")("ufi2").warn("CometUFICommentListState.getVisibleComments: Could not find comment locally: %s",a);return null}return d}).filter(Boolean);a.length>0&&g.length===0&&b("FBLogger")("ufi2").warn("CometUFICommentListState.getVisibleComments: Could not find ANY of the %s comments locally",a.length);return!d.length&&e.commentIDs.length>0&&!(b("gkx")("1098171")&&!b("UFI2ViewOption").isChronologicalOrder(f))?g.sort(function(a,b){return((b=b.created_time)!=null?b:0)-((b=a.created_time)!=null?b:0)}):g},getVisibleCommentsCount:function(a){a.depth;a=a.state;return q(a).length},getVisibleCommentsGroupedByCollapsedState:function(a){var b=a.depth,c=a.reverse,d=a.shouldCollapseComment;a=a.state;b=r.getVisibleComments({depth:b,state:a});a=c?b.slice().reverse():b;return a.reduce(function(a,b){var c=d(b)?"COLLAPSED":"VISIBLE";if(a.length===0)return[{comments:[b],state:c}];var e=a[a.length-1],f=e.comments[e.comments.length-1];if(!f)return a;f=e.state;if(f===c){e.comments.push(b);return a}return[].concat(a,[{comments:[b],state:c}])},[])},getVisibleCommentsWithHiddenCommentsCollapsed:function(a){var b=a.depth,c=a.reverse,d=a.state;return r.getVisibleCommentsGroupedByCollapsedState({depth:b,reverse:c,shouldCollapseComment:function(a){return r.getHiddenStateForComment({commentID:a.id,depth:b,state:d})==="COLLAPSED"},state:d})},hasLastPageLeftInDirection:function(a){a.depth;var b=a.direction,c=a.pageSize,d=a.state;a=a.totalCount;d=n({direction:b,state:d});if(!d)return b==="forward"?a<=c:!1;return b==="forward"?d.afterCount<=c:d.beforeCount<=c},hasMoreInDirection:function(a){a.depth;var b=a.direction,c=a.state;a=a.totalCount;c=n({direction:b,state:c});if(!c)return b==="forward"?a>0:!1;return b==="forward"?c.hasNext:c.hasPrevious},hasPagedInDirection:function(a){a.depth;var b=a.direction;a=a.state;a=a.hasPaged;return a[b]},hasVisibleComments:function(a){var b=a.depth;a=a.state;return r.getVisibleComments({depth:b,state:a}).length>0},isComposerVisible:function(a){a.depth;a=a.state;return a.canViewerComment&&a.expanded&&a.shouldComposerRenderWhenListIsExpanded},isListExpanded:function(a){a.depth;a=a.state;return a.expanded},isListLoading:function(a){var b=a.depth;a=a.state;return b!==0||a.__type!=="DEPTH_0"?!1:a.status.pending},isPagerLoading:function(a){a.depth;var b=a.direction;a=a.state;a=a.pagers;if(!a)return!1;a=a[b];return a!=null?a.status.pending:!1},isPagerVisible:function(a){a.depth;var b=a.direction;a=a.state;a=a.pagers;if(!a)return!1;a=a[b];return a!=null},isRepliesCollapserVisible:function(a){var b=a.depth;a=a.state;if(b===0||a.__type!=="DEPTH_1")return!1;b=a.repliesCollapser;return b!=null},isRepliesExpanderLoading:function(a){var b=a.depth;a=a.state;if(b===0||a.__type!=="DEPTH_1")return!1;b=a.repliesExpander;return b!=null?b.status.pending:!1},isRepliesExpanderVisible:function(a){var b=a.depth;a=a.state;if(b===0||a.__type!=="DEPTH_1")return!1;b=a.repliesExpander;return b!=null},pagerHasRealtimeComments:function(a){var b=a.direction;a=a.state;var c=Object.values(a.newCommentsPage.visibleStates).find(function(a){return a==="HIDDEN"})!=null;return b==="forward"?a.pagers.backward==null?c:!1:c}};e.exports={_updaterDepth0_DO_NOT_USE:a,_updaterDepth1_DO_NOT_USE:c,Selectors:r,StateUpdaters:aa}}),null);
__d("CometUFICommentsProviderState",["FBLogger","gkx","isUFI2ClientID"],(function(a,b,c,d,e,f){"use strict";function g(a){return a!=null&&(a.is_locally_composed===!0||a.is_created_from_subscription===!0||a.optimistic_error!=null||a.optimistic_action!=null)}function h(a){return!a||a.spam_display_mode==null?!1:(a==null?void 0:a.spam_display_mode)!=="none"}function a(a){a=(a=a.feedback.display_comments)==null?void 0:a.before_count;return typeof a==="number"?a:null}function i(a){return a.filter(function(a){return b("isUFI2ClientID")(a)})}function j(a){var c={};a=a?a.map(function(a){if(!a){b("FBLogger")("ufi2").warn("CometUFICommentsProviderState.getCommentsFromEdges(...): Received null edge from comments connection.");return null}a=a.node;if(!a){b("FBLogger")("ufi2").warn("CometUFICommentsProviderState.getCommentsFromEdges(...): Received null comment from comments connection.");return null}if(a.id!=null){var d=a.id;c[d]=a;return d}else{b("FBLogger")("ufi2").warn("CometUFICommentsProviderState.getCommentsFromEdges(...): Received comment with null id from comments connection.");return null}}).filter(Boolean):[];if(a.length>Object.keys(c).length){b("FBLogger")("ufi2").warn("CometUFICommentsProviderState.getCommentsFromEdges(...): Received duplicate comments from comments connection");var d=new Set();return{commentIDs:a.filter(function(a){if(d.has(a))return!1;d.add(a);return!0}),commentsByID:c}}return{commentIDs:a,commentsByID:c}}function k(a,c){var d=Object.keys(a),e=Object.keys(c),f=d.length,g=e.length;if(g>=f)return[];e.every(function(b){return Object.prototype.hasOwnProperty.call(a,b)})||b("FBLogger")("ufi2").warn("CometUFICommentsProvider: Expected next comments to be a subset of previous comments when removing a comment");g=d.filter(function(a){return!Object.prototype.hasOwnProperty.call(c,a)});return g}function l(a,c,d,e){var f=[];d=a.filter(function(a){return!b("isUFI2ClientID")(a)});var g=function(){if(i){if(j>=h.length)return"break";a=h[j++]}else{j=h.next();if(j.done)return"break";a=j.value}var b=a,d=e[b],g=d&&d.client_id!=null?d.client_id:null;g!=null&&c.find(function(a){return a===g})&&f.push({clientID:g,serverID:b})};for(var h=d,i=Array.isArray(h),j=0,h=i?h:h[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){d=g();if(d==="break")break}return f}function m(a,c,d){if(d.length<=c.length)return[];var e=a[d[0]];if(!e){b("FBLogger")("ufi2").warn("CometUFICommentsProviderState.getNewlyCreatedCommentIDs(...): Next most recent comment not found");return[]}e=c.filter(function(b){return g(a[b])});c=d.filter(function(b){return g(a[b])});d=c.length-e.length>0;if(!d)return[];if(e.length===0)return c;var f=new Set(e);return c.filter(function(a){return!f.has(a)})}function n(a,b){return b.filter(function(b){b=a[b];return b!=null&&h(b)})}function o(a,b,c){return c.filter(function(c){var d=a[c];c=b[c];return d!=null&&h(d)===!1&&h(c)===!0})}function p(a,b,c){return c.filter(function(c){var d=a[c];c=b[c];return d!=null&&h(d)===!0&&h(c)===!1})}function c(a,c){var d=a.depth,e=c.commentsByID,f=c.commentIDs;a=j(a.edges);var g=a.commentIDs;a=a.commentsByID;var h=f.length,q=c.clientCommentIDs,r=g.length,s=i(g),t=c.selectedViewOption;c=c.isRefetchingConnection;var u=n(a,g),v=o(e,a,g),w=p(e,a,g);q=l(g,q,s,a);var x=r>h;h=h>r;r=x?m(a,f,g):[];x=h&&!c;f=x?k(e,a):[];h={clientCommentIDs:s,commentIDs:g,commentIDsUpdatedToServerIDs:q,commentsByID:a,hiddenCommentIDs:u,isRefetchingConnection:c,newlyCreatedCommentIDs:r,newlyHiddenCommentIDs:v,newlyUnhiddenCommentIDs:w,removedCommentIDs:f,selectedViewOption:t};b("gkx")("676930")&&window.__enableUFI2CommentsListLogging===!0&&(console.groupCollapsed("%cUFI2 Relay Comments Connection Update at depth "+d+":",";background-color:#75DBCD;color:#1F2D3D;opacity:0.7;font-weight:bold;"),console.groupEnd());return h}function d(a){a=a.edges;a=j(a);var b=a.commentIDs;a=a.commentsByID;var c=i(b),d=n(a,b);return{clientCommentIDs:c,commentIDs:b,commentIDsUpdatedToServerIDs:[],commentsByID:a,hiddenCommentIDs:d,isRefetchingConnection:!1,newlyCreatedCommentIDs:[],newlyHiddenCommentIDs:[],newlyUnhiddenCommentIDs:[],removedCommentIDs:[],selectedViewOption:null}}e.exports={getBeforeCount:a,getClientCommentIDs:i,getCommentIDsUpdatedToServerIDs:l,getCommentsFromEdges:j,getDerivedStateFromProps:c,getHiddenCommentIDs:n,getInitialState:d,getNewlyCreatedCommentIDs:m,getNewlyHiddenCommentIDs:o,getNewlyUnhiddenCommentIDs:p,getRemovedCommentIDs:k}}),null);